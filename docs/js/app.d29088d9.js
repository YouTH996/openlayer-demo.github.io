(function(){"use strict";var t={6647:function(t,e,i){var o=i(6369),n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",{ref:"map",staticClass:"map",attrs:{id:"map"}}),e("search-box"),t.detailBoxVisible?e("detail-box",{ref:"detailBox",on:{detailBoxClose:function(e){t.detailBoxVisible=!1}}}):t._e(),t.map?e("tips-tool",{attrs:{map:t.map,"ship-count":0,zoom:t.zoom}}):t._e()],1)},r=[],s=(i(560),i(1508)),a=i(6205),l=i(2949),c=i(7793),u=i(1870),m=i(2188),d=i(9962),p=i(6265),f=i.n(p);f().defaults.headers["Content-Type"]="application/json;charset=utf-8";const h=f().create({baseURL:{NODE_ENV:"production",BASE_URL:""}.VUE_APP_BASE_API,withCredentials:!0,timeout:1e4});function g(t){let e="";for(const i of Object.keys(t)){const o=t[i];let n=encodeURIComponent(i)+"=";if(null!==o&&"undefined"!==typeof o)if("object"===typeof o){for(const t of Object.keys(o))if(null!==o[t]&&"undefined"!==typeof o[t]){let n=i+"["+t+"]",r=encodeURIComponent(n)+"=";e+=r+encodeURIComponent(o[t])+"&"}}else e+=n+encodeURIComponent(o)+"&"}return e}h.interceptors.request.use((t=>{if("get"===t.method&&t.params){let e=t.url+"?"+g(t.params);e=e.slice(0,-1),t.params={},t.url=e}if("post"===t.method||"put"===t.method){t.url,"object"===typeof t.data?JSON.stringify(t.data):t.data,(new Date).getTime()}return t}),(t=>{console.log(t),Promise.reject(t)})),h.interceptors.response.use((t=>t.data),(t=>(console.log("err"+t),Promise.reject(t))));var v=h;function _(t){return v({url:"/api/app/aisInfo/artAndStaticData",method:"get",params:t})}function b(t){return v({url:"/api/app/aisInfo/rtAndStaticData",method:"get",params:t})}var w=i(8437),y=i(7339),x=i(5934),S=i(4729),P=i(4109),Z=i(7712),k=i(9966),z=i(2205),C=i(7983),T=i(3325);let I;function j(t){return new P.Z({visible:!0,preload:1/0,zIndex:-99,source:new T.Z({url:t})})}function E(t,e){e.setFillStrokeStyle(new Z.Z({color:t}),new k.Z({color:"black",width:2})),e.drawPolygon(new x.ZP([[[1,1],[11,1],[6,16],[1,1]]]))}function O(t,e){e.setFillStrokeStyle(new Z.Z({color:t})),e.drawPolygon(new x.ZP([[[1,1],[11,1],[6,16],[1,1]]]))}function D(t,e){I=document.createElement("canvas"),I.willReadFrequently=!0;let i=(0,S.Pt)(I.getContext("2d"),{size:[25,25]});return E(t,i),t===e&&O(t,i),I}function L({name:t,sog:e,cog:i,hasSelected:o}){let n=[],r=new z.ZP({image:new w.Z({img:D("rgb(0, 255, 0)","rgb(0, 255, 0)"),anchor:[.3,.3],scale:1/window.devicePixelRatio,opacity:.8,imgSize:[I.width,I.height],rotation:Math.PI+Math.PI/(180/i)}),zIndex:99});return n=[r,M(t,i)],o&&n.push(B(25)),n}function M(t,e){let{textAlign:i,offsetX:o,offsetY:n,rotation:r}=F(e);return new z.ZP({image:new y.Z({points:2,radius:15,displacement:[0,15],rotation:r*Math.PI/180,stroke:new k.Z({color:"rgb(0,0,0)"})}),text:new C.Z({font:"10px sans-serif",textAlign:i,justify:"left",text:t,offsetX:o,offsetY:n,fill:new Z.Z({color:[29,55,76,1]}),backgroundFill:new Z.Z({color:[244,251,255,.6]}),padding:[2,2,2,2]})})}function F(t=0){let e,i,o,n;return t>=90&&t<180?(e="left",i=25,o=25,n=135):t>=180&&t<270?(e="right",i=-25,o=25,n=225):t>=270&&t<360?(e="right",i=-25,o=-25,n=315):(e="left",i=25,o=-25,n=45),{textAlign:e,offsetX:i,offsetY:o,rotation:n}}function B(t=25){let e=t*Math.SQRT2;return new z.ZP({image:new y.Z({points:4,radius:t,angle:Math.PI/4,stroke:new k.Z({color:"red",lineCap:"square",lineJoin:"miter",lineDash:[3*e/10,4*e/10,3*e/10,0]})}),zIndex:99999999999999})}function R({name:t,sog:e,cog:i}){let o=[],n=new z.ZP({image:new w.Z({img:D("rgb(0, 255, 0)","rgb(0, 255, 0)"),anchor:[.3,.5],scale:1/window.devicePixelRatio,opacity:.8,imgSize:[I.width,I.height],rotation:Math.PI+Math.PI/(180/i)}),zIndex:99});return o=[n],o}function A(t,e){let i=[];for(let o=0;o<Math.ceil(t.length/e);o++){let n=o*e,r=n+e;i.push((0,d.vs)(t.slice(n,r),"EPSG:3857","EPSG:4326"))}return i}function $(t){let e=t.getView().calculateExtent(t.getSize()),i=A(e,2),o=i[0][0]+","+i[0][1],n=i[1][0]+","+i[1][1];return{minPosStr:o,maxPosStr:n}}var V=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"search-box"}},[e("el-input",{staticStyle:{width:"445px"},model:{value:t.kw,callback:function(e){t.kw=e},expression:"kw"}}),e("el-button",{attrs:{icon:"el-icon-search",type:"primary"}})],1)},H=[],U={name:"search_box",data(){return{kw:""}},methods:{dataFormSubmit(){}}},Y=U,N=i(1001),q=(0,N.Z)(Y,V,H,!1,null,null,null),G=q.exports,X=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"detail-box"}},[e("el-card",[e("el-descriptions",{staticClass:"margin-top",attrs:{title:t.form.shipname,column:2,size:"medium",border:""}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-close",circle:""},on:{click:t.close}})],1),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" MMSI: ")]),t._v(" "+t._s(t.form.mmsi)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 船首向: ")]),t._v(" "+t._s(t.form.trueHeading)+"度 ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 呼号: ")]),t._v(" "+t._s(t.form.callno)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 航向: ")]),t._v(" "+t._s(t.form.cog?t.form.cog/10+"度":"")+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" IMO: ")]),t._v(" "+t._s(t.form.imo)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 航速: ")]),t._v(" "+t._s(t.form.sog?t.form.sog/10+"节":"")+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 类型: ")]),t._v(" "+t._s(t.form.shipTypeText)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 纬度: ")]),t._v(" "+t._s(t.form.latitude)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 状态: ")]),t._v(" "+t._s(t.form.navigationText)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 经度: ")]),t._v(" "+t._s(t.form.longitude)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 船长: ")]),t._v(" "+t._s(t.form.length?`${t.form.length}米`:"")+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 目的地: ")]),t._v(" "+t._s(t.form.dest)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 船宽: ")]),t._v(" "+t._s(t.form.width?`${t.form.width}米`:"")+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 预到时间: ")]),t._v(" "+t._s(t.formatEtaTime(t.form.eta))+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 吃水: ")]),t._v(" "+t._s(t.form.draft?`${t.form.draft}米`:"")+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[t._v(" 更新时间: ")]),t._v(" "+t._s(t.parseTime(t.form.receivetime))+" ")],2)],2)],1)],1)},J=[];function Q(t,e){if(0===arguments.length||!t)return null;const i=e||"{y}-{m}-{d} {h}:{i}:{s}";let o;"object"===typeof t?o=t:("string"===typeof t&&/^[0-9]+$/.test(t)?t=parseInt(t):"string"===typeof t&&(t=t.replace(new RegExp(/-/gm),"/").replace("T"," ").replace(new RegExp(/\.[\d]{3}/gm),"")),"number"===typeof t&&10===t.toString().length&&(t*=1e3),o=new Date(t));const n={y:o.getFullYear(),m:o.getMonth()+1,d:o.getDate(),h:o.getHours(),i:o.getMinutes(),s:o.getSeconds(),a:o.getDay()},r=i.replace(/{(y|m|d|h|i|s|a)+}/g,((t,e)=>{let i=n[e];return"a"===e?["日","一","二","三","四","五","六"][i]:(t.length>0&&i<10&&(i="0"+i),i||0)}));return r}var K={name:"search_box",data(){return{form:""}},methods:{parseTime:Q,init({mmsi:t}){b({mmsi:t}).then((t=>{this.form=t.data}))},close(){this.$emit("detailBoxClose")},formatEtaTime(t){if(t){let e=t;return Q(new Date((new Date).getFullYear()+"-"+e.substring(0,2)+"-"+e.substring(2,4)+" "+e.substring(4,6)+":"+e.substring(6)+":00"))}}}},W=K,tt=(0,N.Z)(W,X,J,!1,null,null,null),et=tt.exports,it=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"tips-tool"}},[t._m(0),t._m(1),e("div",{staticClass:"zoom-wrapper"},[e("div",{attrs:{id:"zoom-block"}},[t._v("当前层级:"+t._s(t.zoom)+" | 船舶数量:"+t._s(t.shipCount))])])])},ot=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"mouse-wrapper"},[e("div",{attrs:{id:"mouse-block"}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"scale-wrapper"},[e("div",{attrs:{id:"scale-block"}})])}],nt=i(8537),rt=i(1673),st=i(7736);let at=null;function lt(t,e){ct(t),at=new nt.Z({coordinateFormat:function(t){const e=(0,st.Fj)(4),i=e(t);return`经度:${i.split(",")[0]}  | 纬度:${i.split(",")[1]} `},projection:"EPSG:4326",className:"custom-mouse-position",target:document.getElementById(e)}),t.addControl(at)}function ct(t){at&&(t.removeControl(at),at=null)}function ut(t,e){let i=new rt.Z({units:"nautical",target:document.getElementById(e)});return t.addControl(i),i}var mt={name:"tips-tool",props:{shipCount:"",map:"",zoom:""},mounted(){this.init()},methods:{init(){lt(this.map,"mouse-block"),ut(this.map,"scale-block")}}},dt=mt,pt=(0,N.Z)(dt,it,ot,!1,null,"69a1eaf4",null),ft=pt.exports,ht={name:"App",components:{TipsTool:ft,searchBox:G,detailBox:et},data(){return{layers:[],shipLayer:void 0,map:void 0,zoom:11,dataList:[],detailBoxVisible:!1}},mounted(){this.initShipLayer(),this.initLayer(),this.initMap(),this.moveHandler(),this.clickHandler()},methods:{initShipLayer(){this.shipLayer=new m.Z({source:new u.Z({})})},initLayer(){let t=j("http://t{0-4}.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=b37845418765777e2fee031e0b569fbb"),e=j("http://t{0-4}.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=b37845418765777e2fee031e0b569fbb");this.layers=[t,e,this.shipLayer]},initMap(){this.map=new a.Z({controls:[],layers:this.layers,view:new c.ZP({center:(0,d.mi)([121.1265,33.3186]),zoom:this.zoom,minZoom:1,maxZoom:18,constrainResolution:!0,smoothExtentConstraint:!0}),target:this.$refs.map})},getDistance(){let t=100;return this.zoom>=16?t=150:15===this.zoom?t=1e4:this.zoom<=14&&(t=2e4),t},shipDataHandler(t){this.getShip(t).then((()=>{console.log((new Date).getTime());for(let t=0;t<this.dataList.length;t++){let e=this.dataList[t],i=this.setShipFeature(e);this.shipLayer.getSource().addFeature(i);for(let o=t+1;o<this.dataList.length;o++){const t=(0,d.mi)([e.longitude,e.latitude]).map(((t,e)=>t-(0,d.mi)([this.dataList[o].longitude,this.dataList[o].latitude])[e])).reduce(((t,e)=>t+e*e),0);t<this.getDistance()&&i.setStyle(R(i.values_))}}console.log((new Date).getTime())}))},setShipFeature(t){const e=new s.Z({geometry:new l.Z((0,d.mi)([t.longitude,t.latitude])),name:t.shipname||t.mmsi.toString(),mmsi:t.mmsi,sog:t.sog,cog:t.cog/10});return e.setStyle(L(e.values_)),e},getShip({minPosStr:t,maxPosStr:e}){return _({lb:t,rt:e}).then((t=>{this.shipLayer.getSource().clear(),this.dataList=t.data}))},moveHandler(){this.map.on("moveend",(()=>{if(this.zoom=this.map.getView().getZoom().toFixed(0),!(this.zoom<11)&&this.map){let t=$(this.map);this.shipDataHandler(t)}})),this.map.on("pointermove",(t=>{this.map.hasFeatureAtPixel(t.pixel)?this.map.getViewport().style.cursor="pointer":this.map.getViewport().style.cursor="inherit"}))},clickHandler(){this.map.on("singleclick",(t=>{const e=this.map.forEachFeatureAtPixel(t.pixel,(t=>t));if(e){e.values_.hasSelected=!0;let t=e.getStyle();t.push(B()),e.setStyle(t),this.detailBoxVisible=!0,this.$nextTick((()=>{this.$refs["detailBox"].init(e.values_)}))}}))}}},gt=ht,vt=(0,N.Z)(gt,n,r,!1,null,null,null),_t=vt.exports,bt=i(8499),wt=i.n(bt);o["default"].use(wt()),o["default"].config.productionTip=!1,new o["default"]({render:t=>t(_t)}).$mount("#app")}},e={};function i(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={id:o,loaded:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,function(){i.amdO={}}(),function(){var t=[];i.O=function(e,o,n,r){if(!o){var s=1/0;for(u=0;u<t.length;u++){o=t[u][0],n=t[u][1],r=t[u][2];for(var a=!0,l=0;l<o.length;l++)(!1&r||s>=r)&&Object.keys(i.O).every((function(t){return i.O[t](o[l])}))?o.splice(l--,1):(a=!1,r<s&&(s=r));if(a){t.splice(u--,1);var c=n();void 0!==c&&(e=c)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[o,n,r]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,o){var n,r,s=o[0],a=o[1],l=o[2],c=0;if(s.some((function(e){return 0!==t[e]}))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(l)var u=l(i)}for(e&&e(o);c<s.length;c++)r=s[c],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(u)},o=self["webpackChunkopenlayer_demo"]=self["webpackChunkopenlayer_demo"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=i.O(void 0,[998],(function(){return i(6647)}));o=i.O(o)})();
//# sourceMappingURL=app.d29088d9.js.map